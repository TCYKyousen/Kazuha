import xml.etree.ElementTree as ET
import os

translations = {
    "en": {
        "SettingsWindow": {
            "关于 Kazuha": "About Kazuha",
            "ClassIsland/Class Widgets 的部分功能与本应用的时钟组件存在重叠，且另一部分功能甚至可以超出时钟组件所能做到的范围。\n为避免冲突，当前时钟组件已被临时禁用。": "Some functions of ClassIsland/Class Widgets overlap with the clock component of this application, and other functions can even exceed the range of what the clock component can do.\nTo avoid conflicts, the current clock component has been temporarily disabled.",
            "GitHub 仓库": "GitHub Repository",
            "Kazuha 万叶演示助手": "Kazuha Presentation Helper",
            "一款用于课堂与演示场景的现代化 PPT 演示辅助工具，可替代部分希沃演示助手的功能。": "A modern PPT presentation auxiliary tool for classroom and presentation scenarios, which can replace some functions of Seewo Presentation Helper.",
            "个性化": "Personalization",
            "个性化与外观": "Personalization and Appearance",
            "中部两侧": "Middle Sides",
            "主题与颜色": "Theme and Color",
            "交流 QQ 群": "QQ Group",
            "仅用于开发调试环境，请勿在正式课堂或演示时点击": "Only for development and debugging environment, please do not click in formal classrooms or presentations",
            "从 GitHub 检查最新可用的 Release 版本": "Check for the latest available Release version from GitHub",
            "作者：Seirai Studio / @Haraguse": "Author: Seirai Studio / @Haraguse",
            "加入": "Join",
            "危险功能（仅限测试）": "Dangerous Features (Test Only)",
            "右上角": "Top Right",
            "右下角": "Bottom Right",
            "在 GitHub 上查看参与开发与维护的贡献者列表": "View the list of contributors involved in development and maintenance on GitHub",
            "增强版 PPT 演示辅助工具": "Enhanced PPT Presentation Helper",
            "在 GitHub 上查看项目主页与源代码": "View project homepage and source code on GitHub",
            "在屏幕上显示一个可自定义的悬浮时钟窗口": "Display a customizable floating clock window on the screen",
            "官方网站": "Official Website",
            "屏幕中央": "Screen Center",
            "崩溃测试": "Crash Test",
            "左上角": "Top Left",
            "左下角": "Bottom Left",
            "布局与位置": "Layout and Position",
            "常规": "General",
            "应用主题": "App Theme",
            "底部两端": "Bottom Sides",
            "开发与维护": "Development and Maintenance",
            "当前正在运行的版本：{version}": "Currently running version: {version}",
            "当前版本更新日志：\\n{text}": "Current version update log:\\n{text}",
            "当前版本更新日志：请在 GitHub Releases 查看对应版本说明": "Current version update log: Please check the corresponding version description in GitHub Releases",
            "当前版本：{version}": "Current version: {version}",
            "感谢所有参与开发、测试与反馈的贡献者。": "Thanks to all contributors who participated in development, testing, and feedback.",
            "打开": "Open",
            "指定倒计时窗口在屏幕中的停靠位置": "Specify the docking position of the countdown window on the screen",
            "控制工具条、时钟等组件距离屏幕四边的安全留白范围": "Control the safe margin of toolbars, clocks, and other components from the four sides of the screen",
            "无更新日志": "No update log",
            "时钟位置": "Clock Position",
            "时钟样式": "Clock Style",
            "显示内容与样式": "Content and Style",
            "显示悬浮时钟": "Show Floating Clock",
            "更新内容": "Update Content",
            "更新日志": "Update Log",
            "最新 Release 版本更新日志：\\n{text}": "Latest Release version update log:\\n{text}",
            "最新可用 Release 版本：{version}": "Latest available Release version: {version}",
            "最新可用 Release 版本：正在检查...": "Latest available Release version: Checking...",
            "未知": "Unknown",
            "查看": "View",
            "桌面悬浮时钟组件": "Desktop Floating Clock Component",
            "检查并安装更新": "Check and Install Update",
            "检测到 ClassIsland/Class Widgets 正在运行": "ClassIsland/Class Widgets detected running",
            "正在从网络检查更新...": "Checking for updates from the network...",
            "浅色主题": "Light Theme",
            "深色主题": "Dark Theme",
            "版本信息": "Version Information",
            "版本更新": "Version Update",
            "版本状态": "Version Status",
            "立即重启": "Restart Now",
            "组件屏幕边距": "Component Screen Margin",
            "翻页导航位置": "Page Navigation Position",
            "自定义悬浮时钟显示的内容、字体和粗细等外观": "Customize the appearance of the floating clock, including content, font, and weight",
            "触发": "Trigger",
            "计时器位置": "Timer Position",
            "访问": "Visit",
            "调整桌面悬浮时钟在屏幕四角的显示位置": "Adjust the display position of the desktop floating clock at the four corners of the screen",
            "调试": "Debug",
            "贡献者": "Contributors",
            "跟随系统主题": "Follow System Theme",
            "选择浅色、深色或跟随系统的应用主题外观": "Choose light, dark, or follow system theme for application appearance",
            "选择演示时上一页/下一页按钮在屏幕上的位置": "Choose the position of the previous/next buttons on the screen during presentation",
            "通过 README 中的二维码或链接加入交流讨论群": "Join the discussion group via the QR code or link in README",
            "通过系统通知中心显示提示和警告消息": "Display tips and warning messages through the system notification center",
            "项目与社区": "Project and Community",
            "预留站点，用于未来展示更多功能与文档": "Reserved site for future display of more features and documentation",
        },
        "Main": {
            "万演 主程序通知": "Kazuha Main Notification",
        },
        "Context": {
            "Text": "Text",
        },
        "BusinessLogic": {
            "一个现代化、高性能的 PowerPoint 演示辅助工具，用于配合课堂与演示场景。": "A modern, high-performance PowerPoint presentation auxiliary tool for classroom and presentation scenarios.",
            "丢弃": "Discard",
            "保留": "Keep",
            "倒计时结束": "Countdown Finished",
            "关于 Kazuha 演示助手": "About Kazuha Presentation Helper",
            "关于 PPT助手": "About PPT Helper",
            "发现新版本": "New Version Found",
            "当前版本: {version}": "Current version: {version}",
            "当前版本: {version}\\n\\n一个专注于演示辅助的工具。\\n\\nDesigned by Seirai.": "Current version: {version}\\n\\nA tool focused on presentation assistance.\\n\\nDesigned by Seirai.",
            "当前页没有笔迹": "No ink on current page",
            "是否保留墨迹注释？": "Do you want to keep the ink annotations?",
            "未找到可执行的更新文件": "Executable update file not found",
            "检测到 ClassIsland/ClassWidgets，已自动隐藏时钟组件。": "ClassIsland/ClassWidgets detected, clock component automatically hidden.",
            "正在后台下载更新...": "Downloading update in the background...",
            "版本: {version}\\n\\n{body}\\n\\n是否立即更新？": "Version: {version}\\n\\n{body}\\n\\nUpdate now?",
            "界面和功能设置": "Interface and Functional Settings",
            "翻页组件位置设置已保存，将在下一次放映时生效。": "Page navigation component position settings saved and will take effect at the next show.",
            "语言设置将在重启后生效": "Language settings will take effect after restart",
            "退出 Kazuha": "Exit Kazuha",
            "退出放映": "Exit Slideshow",
        },
        "ClockSettings": {
            "{year}年{month}月{day}日": "{year}-{month}-{day}",
            "上午": "AM",
            "下午": "PM",
            "农历（示例）": "Lunar (Example)",
            "半粗": "Medium",
            "完成": "Done",
            "常规": "General",
            "打开时钟详细设置": "Open detailed clock settings",
            "时钟时间字体粗细": "Clock time font weight",
            "时钟显示内容与样式配置": "Clock content and style configuration",
            "是否在时钟下方显示公历日期": "Whether to display the Gregorian date below the clock",
            "是否在时钟下方显示农历信息": "Whether to display Lunar information below the clock",
            "是否在时钟中显示秒数": "Whether to display seconds in the clock",
            "显示秒": "Show Seconds",
            "粗体": "Bold",
            "细": "Thin",
        },
        "CrashHandler": {
            "Process {pid} exited with code {code}": "Process {pid} exited with code {code}",
            "程序发生错误并已停止运行。你可以复制错误信息用于反馈。": "The program encountered an error and has stopped running. You can copy the error message for feedback.",
        },
        "Widgets": {
            " 分": " min",
            " 秒": " sec",
            "上午": "AM",
            "下午": "PM",
            "倒计时": "Countdown",
            "倒计时剩余{}分{}秒": "Countdown remaining: {}m {}s",
            "倒计时剩余{}分钟": "Countdown remaining: {}m",
            "倒计时剩余{}秒": "Countdown remaining: {}s",
            "倒计时已结束": "Countdown ended",
            "关闭": "Close",
            "农历": "Lunar",
            "农历(缺库)": "Lunar (Library missing)",
            "分": "m",
            "剩余播报:": "Remaining Broadcast:",
            "取消": "Cancel",
            "周一": "Mon",
            "周三": "Wed",
            "周二": "Tue",
            "周五": "Fri",
            "周六": "Sat",
            "周四": "Thu",
            "周日": "Sun",
            "墨迹颜色": "Ink Color",
            "年": "Y",
            "幻灯片预览": "Slide Preview",
            "开启": "On",
            "开启强提醒": "Enable Alert",
            "开始": "Start",
            "强提醒已关闭": "Alert Disabled",
            "强提醒已开启": "Alert Enabled",
            "强提醒模式下，倒计时结束时将：\\n\\n1. 强制弹出计时窗口\\n2. 播放高强度警报音\\n3. 窗口持续抖动\\n4. 显示全屏遮罩\\n\\n只有点击“返回”按钮才能停止提醒。": "In alert mode, when the countdown ends:\\n\\n1. Force pop up the timer window\\n2. Play a high-intensity alarm sound\\n3. Window shakes continuously\\n4. Show full-screen mask\\n\\nYou can only stop the alert by clicking the 'Back' button.",
            "指针": "Pointer",
            "日": "D",
            "暂停": "Pause",
            "月": "M",
            "橙": "Orange",
            "橡皮擦": "Eraser",
            "橡皮擦选项": "Eraser Options",
            "正在加载...": "Loading...",
            "正在加载幻灯片预览...": "Loading slide preview...",
            "正计时": "Stopwatch",
            "清空所有笔迹": "Clear All Ink",
            "清除全部批注": "Clear All Annotations",
            "清除当前页笔迹": "Clear Current Page Ink",
            "画笔": "Pen",
            "白": "White",
            "秒": "s",
            "筆": "Pen",
            "紅": "Red",
            "紫": "Purple",
            "綠": "Green",
            "结束播报:": "End Broadcast:",
            "聚焦高亮": "Spotlight",
            "藍": "Blue",
            "计时器": "Timer",
            "计时工具": "Timer Tool",
            "返回": "Back",
            "退出批注": "Exit Annotation",
            "退出放映": "Exit Slideshow",
            "重置": "Reset",
            "铃声:": "Ringtone:",
            "青": "Cyan",
            "页码": "Page",
            "黃": "Yellow",
            "黑": "Black",
            "默认": "Default",
        },
        "CustomSettings": {
            "两侧": "Sides",
            "中部右侧": "Middle Right",
            "中部左侧": "Middle Left",
            "取消": "Cancel",
            "右边距": "Right Margin",
            "大边距": "Large Margin",
            "小边距": "Small Margin",
            "左边距": "Left Margin",
            "应用当前设置": "Apply Settings",
            "底部两端": "Bottom Sides",
            "底部右侧": "Bottom Right",
            "底部居中": "Bottom Center",
            "底部左侧": "Bottom Left",
            "快速预设": "Presets",
            "日本語": "Japanese",
            "简体中文": "Simplified Chinese",
            "繁體中文": "Traditional Chinese",
            "英语": "English",
            "日语": "Japanese",
            "藏语": "Tibetan",
            "浅色主题": "Light Theme",
            "深色主题": "Dark Theme",
            "组件屏幕边距": "Screen Margin",
            "调整边距": "Adjust Margin",
            "跟随系统主题": "Follow System",
            "锁定四个边距相同": "Lock Margins",
            "English": "English",
            "བོད་ཡིག": "Tibetan",
            "上边距": "Top Margin",
            "下边距": "Bottom Margin",
            "中等边距": "Medium Margin",
            "中部两侧": "Middle Sides",
        },
        "CrashDialog": {
            "取消": "Cancel",
            "堆栈溢出（递归调用）": "Stack Overflow (Recursive)",
            "崩溃行为测试配置": "Crash Test Config",
            "常规崩溃（抛出异常）": "Normal Crash (Exception)",
            "自定义崩溃文本（仅在常规崩溃模式下生效）": "Custom Crash Text (Exception only)",
            "触发前倒计时 3 秒": "3s Countdown before trigger",
            "触发崩溃": "Trigger Crash",
        },
        "VersionManager": {
            "下载或安装更新时出错: {e}": "Error downloading or installing update: {e}",
            "安装失败: {e}": "Installation failed: {e}",
            "文件哈希校验失败": "File hash verification failed",
        }
    },
    "ja": {
        "SettingsWindow": {
            "关于 Kazuha": "Kazuha について",
            "GitHub 仓库": "GitHub リポジトリ",
            "Kazuha 万叶演示助手": "Kazuha プレゼンテーションヘルパー",
            "个性化": "パーソナライズ",
            "个性化与外观": "パーソナライズと外观",
            "中部两侧": "中央両側",
            "主题与颜色": "テーマと色",
            "交流 QQ 群": "QQ グループ",
            "关于": "について",
            "加入": "参加",
            "右上角": "右上",
            "右下角": "右下",
            "左上角": "左上",
            "左下角": "左下",
            "布局与位置": "レイアウトと配置",
            "常规": "全般",
            "应用主题": "アプリのテーマ",
            "底部两端": "下部両端",
            "开发与维护": "開発とメンテナンス",
            "当前版本：{version}": "現在のバージョン：{version}",
            "打开": "開く",
            "无更新日志": "更新履歴なし",
            "时钟位置": "時計の位置",
            "时钟样式": "時計のスタイル",
            "显示内容与样式": "表示内容とスタイル",
            "显示悬浮时钟": "フローティング時計を表示",
            "更新内容": "更新内容",
            "更新日志": "更新履歴",
            "未知": "不明",
            "查看": "表示",
            "桌面悬浮时钟组件": "デスクトップ時計コンポーネント",
            "检查更新": "更新を確認",
            "浅色主题": "ライト",
            "深色主题": "ダーク",
            "版本信息": "バージョン情報",
            "版本更新": "アップデート",
            "立即重启": "今すぐ再起動",
            "翻页导航位置": "ページナビゲーションの位置",
            "调试": "デバッグ",
            "贡献者": "貢献者",
            "跟随系统主题": "システムに従う",
            "项目与社区": "プロジェクトとコミュニティ",
            "通过系统通知中心显示提示和警告消息": "システム通知センターを介してヒントと警告メッセージを表示する",
        },
        "CustomSettings": {
            "English": "English",
            "བོད་ཡིག": "チベット語",
            "日本語": "日本語",
            "简体中文": "簡体中国語",
            "繁體中文": "繁体中国語",
            "浅色主题": "ライト",
            "深色主题": "ダーク",
            "跟随系统主题": "システムに従う",
        },
        "Widgets": {
            "倒计时": "カウントダウン",
            "正计时": "ストップウォッチ",
            "开始": "開始",
            "暂停": "一時停止",
            "重置": "リセット",
            "返回": "戻る",
            "关闭": "閉じる",
            "画笔": "ペン",
            "橡皮擦": "消しゴム",
            "清空所有笔迹": "すべてのインクを消去",
            "退出批注": "注釈を終了",
            "退出放映": "スライドショーを終了",
            "聚焦高亮": "スポットライト",
            "上午": "午前",
            "下午": "午後",
            "周一": "月曜日",
            "周二": "火曜日",
            "周三": "水曜日",
            "周四": "木曜日",
            "周五": "金曜日",
            "周六": "土曜日",
            "周日": "日曜日",
        },
        "BusinessLogic": {
            "确定": "OK",
            "退出 Kazuha": "Kazuha を終了",
            "界面和功能设置": "設定",
        },
        "ClockSettings": {
            "完成": "完了",
            "常规": "全般",
            "粗体": "太字",
            "细": "細字",
            "半粗": "中太",
        }
    },
    "zh_TW": {
        "SettingsWindow": {
            "关于 Kazuha": "關於 Kazuha",
            "ClassIsland/Class Widgets 的部分功能与本应用的时钟组件存在重叠，且另一部分功能甚至可以超出时钟组件所能做到的范围。\n为避免冲突，当前时钟组件已被临时禁用。": "ClassIsland/Class Widgets 的部分功能與本應用的時鐘組件存在重疊，且另一部分功能甚至可以超出時鐘組件所能做到的範圍。\n為避免衝突，當前時鐘組件已被臨時禁用。",
            "GitHub 仓库": "GitHub 倉庫",
            "Kazuha 万叶演示助手": "Kazuha 萬葉演示助手",
            "个性化": "個性化",
            "个性化与外观": "個性化與外觀",
            "中部两侧": "中部兩側",
            "主题与颜色": "主題與顏色",
            "交流 QQ 群": "交流 QQ 群",
            "关于": "關於",
            "加入": "加入",
            "右上角": "右上角",
            "右下角": "右下角",
            "左上角": "左上角",
            "左下角": "左下角",
            "布局与位置": "佈局與位置",
            "常规": "常規",
            "应用主题": "應用主題",
            "底部两端": "底部兩端",
            "开发与维护": "開發與維護",
            "当前版本：{version}": "當前版本：{version}",
            "打开": "打開",
            "无更新日志": "無更新日誌",
            "时钟位置": "時鐘位置",
            "时钟样式": "時鐘樣式",
            "显示内容与样式": "顯示內容與樣式",
            "显示悬浮时钟": "顯示懸浮時鐘",
            "更新内容": "更新內容",
            "更新日志": "更新日誌",
            "未知": "未知",
            "查看": "查看",
            "桌面悬浮时钟组件": "桌面懸浮時鐘組件",
            "检查更新": "檢查更新",
            "浅色主题": "淺色主題",
            "深色主题": "深色主題",
            "版本信息": "版本信息",
            "版本更新": "版本更新",
            "立即重启": "立即重啟",
            "翻页导航位置": "翻頁導航位置",
            "调试": "調試",
            "贡献者": "貢獻者",
            "跟随系统主题": "跟隨系統主題",
            "项目与社区": "項目與社區",
            "通过系统通知中心显示提示和警告消息": "透過系統通知中心顯示提示和警告消息",
        },
        "CustomSettings": {
            "English": "English",
            "བོད་ཡིག": "藏文",
            "日本語": "日本語",
            "简体中文": "簡體中文",
            "繁體中文": "繁體中文",
            "浅色主题": "淺色主題",
            "深色主题": "深色主題",
            "跟随系统主题": "跟隨系統主題",
        },
        "Widgets": {
            "倒计时": "倒計時",
            "正计时": "正計時",
            "开始": "開始",
            "暂停": "暫停",
            "重置": "重置",
            "返回": "返回",
            "关闭": "關閉",
            "画笔": "畫筆",
            "橡皮擦": "橡皮擦",
            "清空所有笔迹": "清空所有筆跡",
            "退出批注": "退出批注",
            "退出放映": "退出放映",
            "聚焦高亮": "聚焦高亮",
            "上午": "上午",
            "下午": "下午",
        },
        "BusinessLogic": {
            "确定": "確定",
            "退出 Kazuha": "退出 Kazuha",
            "界面和功能设置": "界面和功能設置",
        },
        "ClockSettings": {
            "完成": "完成",
            "常规": "常規",
            "粗体": "粗體",
            "细": "細",
            "半粗": "半粗",
        }
    },
    "bo": {
        "SettingsWindow": {
            "关于 Kazuha": "Kazuha སྐོར།",
            "关于": "སྐོར།",
            "退出": "ཕྱིར་ཐོན།",
            "常规": "རྒྱུན་ལྡན།",
            "个性化": "སྒེར་གཤིས།",
            "更新": "གསར་སྒྱུར།",
            "调试": "调试",
            "贡献者": "贡献者",
            "项目与社区": "项目与社区",
            "检查更新": "གསར་སྒྱུར་བཤེར་བ།",
            "应用主题": "应用主题",
            "跟随系统主题": "跟随系统主题",
            "浅色主题": "浅色主题",
            "深色主题": "深色主题",
            "立即重启": "ད་ལྟ་བསྐྱར་དུ་སྤར་བ།",
            "组件屏幕边距": "ལྷུ་ལག་གི་བརྙན་ཤེལ་མཐའ་འགྲམ།",
        },
        "Widgets": {
            "倒计时": "དུས་ཚོད་བརྩི་བཤེར།",
            "正计时": "དུས་ཚོད་དངོས་བརྩི།",
            "开始": "འགོ་འཛུགས།",
            "暂停": "བར་མཚམས་འཇོག་པ།",
            "重置": "བསྐྱར་སྒྲིག",
            "返回": "ཕྱིར་ལོག",
            "关闭": "ཁ་རྒྱག་པ།",
            "画笔": "སྨྱུག་གུ།",
            "橡皮擦": "ས་འབྲུད།",
            "退出放映": "སྟོན་མཚམས་འཇོག་པ།",
            "上午": "སྔ་དྲོ།",
            "下午": "ཕྱི་དྲོ།",
            "倒计时剩余{}分{}秒": "དུས་ཚོད་བརྩི་བཤེར་ལྷག་མ། {} སྐར་མ། {} སྐར་ཆ།",
            "倒计时剩余{}分钟": "དུས་ཚོད་བརྩི་བཤེར་ལྷག་མ། {} སྐར་མ།",
            "倒计时剩余{}秒": "དུས་ཚོད་བརྩི་བཤེར་ལྷག་མ། {} སྐར་ཆ།",
            "倒计时已结束": "དུས་ཚོད་བརྩི་བཤེར་མཇུག་རྫོགས་སོ།",
        },
        "BusinessLogic": {
            "确定": "གཏན་འཁེལ།",
            "退出 Kazuha": "Kazuha ཕྱིར་འཐེན།",
            "语言设置将在重启后生效": "སྐད་ཡིག་སྒྲིག་བཀོད་བསྐྱར་དུ་སྤར་རྗེས་ནུས་པ་ཐོན་པ།",
            "丢弃": "དོར་བ།",
            "保留": "ཉར་ཚགས།",
        },
        "ClockSettings": {
            "完成": "གཏན་འཁེལ།",
            "常规": "རྒྱུན་ལྡན།",
        }
    }
}

def fill_ts_file(ts_path, lang_translations):
    if not os.path.exists(ts_path):
        return
    
    tree = ET.parse(ts_path)
    root = tree.getroot()
    
    modified = False
    for context in root.findall('context'):
        context_name = context.find('name').text
        if context_name not in lang_translations:
            continue
        
        ctx_trans = lang_translations[context_name]
        for message in context.findall('message'):
            source = message.find('source').text
            if source is None:
                continue
            
            translation = message.find('translation')
            
            norm_source = " ".join(source.split())
            
            target_trans = None
            if source in ctx_trans:
                target_trans = ctx_trans[source]
            else:
                for s, t in ctx_trans.items():
                    if " ".join(s.split()) == norm_source:
                        target_trans = t
                        break

            if target_trans:
                if translation.text is None or translation.text.strip() == "" or translation.text != target_trans:
                    translation.text = target_trans
                    modified = True
    
    if modified:
        def indent(elem, level=0):
            i = "\n" + level*"    "
            if len(elem):
                if not elem.text or not elem.text.strip():
                    elem.text = i + "    "
                if not elem.tail or not elem.tail.strip():
                    elem.tail = i
                for elem in elem:
                    indent(elem, level+1)
                if not elem.tail or not elem.tail.strip():
                    elem.tail = i
            else:
                if level and (not elem.tail or not elem.tail.strip()):
                    elem.tail = i
        
        indent(root)
        tree = ET.ElementTree(root)
        with open(ts_path, 'wb') as f:
            f.write(b"<?xml version='1.0' encoding='utf-8'?>\n")
            tree.write(f, encoding='utf-8', xml_declaration=False)
        print(f"Updated {ts_path}")

ts_files = {
    "en": "translations/kazuha_en.ts",
    "ja": "translations/kazuha_ja.ts",
    "zh_TW": "translations/kazuha_zh_TW.ts",
    "bo": "translations/kazuha_bo.ts",
}

for lang, path in ts_files.items():
    if lang in translations:
        fill_ts_file(path, translations[lang])
