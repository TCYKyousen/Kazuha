<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Settings</title>
  <style>
    :root {
      --bg-app: #F5F6F8;
      --bg-surface: #FFFFFF;
      --text-primary: #191919;
      --text-secondary: #8C8C8C;
      --accent-blue: #3275F5;
      --divider: rgba(0, 0, 0, 0.05);
      --card-bg: rgba(0, 0, 0, 0.02);
      --card-border: rgba(0, 0, 0, 0.01);
      --item-hover: rgba(0, 0, 0, 0.03);
      --shadow-color: rgba(0, 0, 0, 0.06);
      --shadow-main: 0 4px 24px var(--shadow-color);
      --logo-glow: rgba(255, 255, 255, 0.4);
      --hyperos-g1: #e0e7ff;
      --hyperos-g2: #fef3c7;
      --hyperos-g3: #fce7f3;
      --hyperos-g4: #d1fae5;
      --hyperos-g5: #ffffff;
      --font-stack: "MiSans Latin", "HarmonyOS Sans SC", "Source Han Sans CN", "Noto Sans CJK SC", "Microsoft YaHei", system-ui, sans-serif;
    }

    [data-theme="dark"] {
      --bg-app: #121212;
      --bg-surface: #1E1E1E;
      --text-primary: #E5E5E5;
      --text-secondary: #909090;
      --accent-blue: #4A85F6;
      --divider: rgba(255, 255, 255, 0.08);
      --card-bg: rgba(255, 255, 255, 0.03);
      --card-border: rgba(255, 255, 255, 0.02);
      --item-hover: rgba(255, 255, 255, 0.05);
      --shadow-color: rgba(0, 0, 0, 0.3);
      --shadow-main: 0 8px 32px var(--shadow-color);
      --logo-glow: rgba(255, 255, 255, 0.15);
      --hyperos-g1: #1e293b;
      --hyperos-g2: #334155;
      --hyperos-g3: #1e1b4b;
      --hyperos-g4: #064e3b;
      --hyperos-g5: #0f172a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    html, body {
      background: var(--bg-app);
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      color: var(--text-primary);
      font-family: var(--font-stack);
      display: flex;
      flex-direction: column;
    }

    .layout {
      display: flex;
      flex: 1;
      padding: 12px;
      gap: 12px;
      overflow: hidden;
    }

    .sidebar {
      width: 220px;
      padding: 10px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: var(--bg-surface);
      border-radius: 16px;
      border: 1px solid var(--divider);
      box-shadow: var(--shadow-main);
    }

    .sidebar-item {
      padding: 10px 14px;
      font-size: 14px;
      color: var(--text-secondary);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 12px;
      background: transparent;
      border: none;
      width: 100%;
      text-align: left;
    }

    .sidebar-item[data-section="about"] {
      margin-top: auto;
    }

    .sidebar-item:hover {
      background: var(--item-hover);
      color: var(--text-primary);
    }

    .sidebar-item.active {
      color: var(--accent-blue);
      background: var(--card-bg);
      font-weight: 600;
    }

    .sidebar-icon {
      width: 18px;
      height: 18px;
      fill: none;
      stroke: currentColor;
      stroke-width: 1.8;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0.7;
    }

    .sidebar-item.active .sidebar-icon {
      opacity: 1;
    }

    .content {
      flex: 1;
      padding: 32px 48px;
      overflow-y: auto;
      background: var(--bg-surface);
      border-radius: 16px;
      border: 1px solid var(--divider);
      box-shadow: var(--shadow-main);
    }

    .page-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 24px;
      color: var(--text-primary);
    }

    .section {
      display: none;
      margin-top: 0;
    }

    .section.active {
      display: block;
    }

    .settings-group {
      background: var(--card-bg);
      border-radius: 12px;
      margin-bottom: 24px;
      overflow: hidden;
      max-width: 1000px;
      border: 1px solid var(--card-border);
    }

    .group-title {
      padding: 0 0 16px;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .settings-item {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 60px;
      border-bottom: 1px solid var(--divider);
      transition: background 0.15s;
    }

    .settings-item:last-child {
      border-bottom: none;
    }

    .settings-item:hover {
      background: var(--item-hover);
    }

    .item-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .item-label {
      font-size: 15px;
      color: var(--text-primary);
      font-weight: normal;
    }

    .item-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .item-state {
      display: flex;
      align-items: center;
      color: var(--text-secondary);
      font-size: 15px;
    }

    .chevron {
      width: 14px;
      height: 14px;
      margin-left: 6px;
      opacity: 0.3;
      fill: currentColor;
    }

    .version-expander {
      padding: 0 20px 16px 20px;
      border-top: 1px solid var(--divider);
      font-size: 12px;
      color: var(--text-secondary);
      display: none;
    }

    .version-expander-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .version-expander-text {
      line-height: 1.5;
    }

    .version-expander-links a {
      font-size: 12px;
      color: var(--accent-blue);
      text-decoration: none;
      margin-left: 8px;
    }

    .version-expander-links a:hover {
      text-decoration: underline;
    }

    .slider-container {
      height: 36px;
      background: transparent;
      border-radius: 18px;
      position: relative;
      display: flex;
      align-items: center;
      padding: 0;
      margin-top: 16px;
      overflow: visible;
    }

    .slider-track {
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 4px;
      background: var(--divider);
      border-radius: 2px;
    }

    .slider-fill {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 4px;
      width: 50%;
      background: var(--accent-blue);
      border-radius: 2px;
      pointer-events: none;
    }

    .slider-input {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      z-index: 2;
    }

    .switch {
      width: 44px;
      height: 22px;
      background: var(--divider);
      border-radius: 11px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      flex-shrink: 0;
    }

    .switch.active {
      background: var(--accent-blue);
    }

    .switch::after {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      background: var(--bg-surface);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px var(--shadow-color);
    }

    .switch.active::after {
      transform: translateX(20px);
    }

    .theme-select {
      display: flex;
      background: var(--card-bg);
      padding: 4px;
      border-radius: 12px;
      gap: 4px;
      border: 1px solid var(--card-border);
    }

    .theme-option {
      padding: 6px 16px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-secondary);
    }

    .theme-option.active {
      background: var(--bg-surface);
      color: var(--accent-blue);
      box-shadow: 0 2px 8px var(--shadow-color);
      font-weight: 500;
    }

    .about-header {
      position: relative;
      width: calc(100% + 96px);
      height: 320px;
      margin: -32px -48px 32px -48px;
      border-radius: 16px 16px 0 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg-surface);
    }

    .hyperos-bg {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 20% 20%, var(--hyperos-g1) 0%, transparent 40%),
                  radial-gradient(circle at 80% 80%, var(--hyperos-g2) 0%, transparent 40%),
                  radial-gradient(circle at 20% 80%, var(--hyperos-g3) 0%, transparent 40%),
                  radial-gradient(circle at 80% 20%, var(--hyperos-g4) 0%, transparent 40%),
                  radial-gradient(circle at 50% 50%, var(--hyperos-g5) 0%, transparent 50%);
      filter: blur(60px);
      animation: hyperos-flow 25s infinite linear;
      z-index: 0;
      opacity: 0.9;
    }

    .about-header::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: linear-gradient(to bottom, transparent, var(--bg-surface));
      pointer-events: none;
      z-index: 2;
    }

    @keyframes hyperos-flow {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    .about-logo-container {
      position: relative;
      z-index: 3;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .about-main-logo {
      width: 180px;
      height: 180px;
      display: block;
      filter: drop-shadow(0 12px 32px rgba(0, 0, 0, 0.15));
    }

    [data-theme="dark"] .about-main-logo {
      filter: drop-shadow(0 0 25px rgba(50, 117, 245, 0.6));
    }

    .about-main-logo path {
      fill: rgba(255, 255, 255, 0.1);
      stroke: rgba(255, 255, 255, 0.4);
      stroke-width: 1.2px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    [data-theme="dark"] .about-main-logo path {
      fill: rgba(255, 255, 255, 0.05);
      stroke: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>

<body>
  <div class="layout">
    <div class="sidebar">
      <div class="sidebar-item active" data-section="general">
        <svg class="sidebar-icon" viewBox="0 0 24 24">
          <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
          <path
            d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
        </svg>
        <span>通用</span>
      </div>
      <div class="sidebar-item" data-section="interaction">
        <svg class="sidebar-icon" viewBox="0 0 24 24">
          <path
            d="M18 8a3 3 0 013 3 3 3 0 01-3 3h-1V8h1zM14 8h-4v6h4V8zM19 19H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2z" />
        </svg>
        <span>交互</span>
      </div>
      <div class="sidebar-item" data-section="about">
        <svg class="sidebar-icon" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <path d="M12 16v-4" />
          <path d="M12 8h.01" />
        </svg>
        <span>关于</span>
      </div>
      <div class="sidebar-item" data-section="debug" id="nav-debug" style="display:none;">
        <svg class="sidebar-icon" viewBox="0 0 24 24">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.77 3.77z"/>
        </svg>
        <span>调试</span>
      </div>
    </div>

    <div class="content">
      <div class="page-title" id="section-title">通用</div>

      <div class="section active" id="section-general">
        <div class="group-title">外观</div>
        <div class="settings-group">
          <div class="settings-item">
            <div class="item-info">
              <span class="item-label">外观模式</span>
              <span class="item-desc">调整应用程序的显示主题</span>
            </div>
            <div class="theme-select">
              <div class="theme-option" id="theme-Light" onclick="setTheme('Light')">浅色</div>
              <div class="theme-option" id="theme-Dark" onclick="setTheme('Dark')">深色</div>
              <div class="theme-option" id="theme-Auto" onclick="setTheme('Auto')">跟随系统</div>
            </div>
          </div>
          
        </div>

        <div class="group-title">通用</div>
        <div class="settings-group">
          <div class="settings-item" onclick="toggleSwitch('General', 'RunAtStartup')">
            <div class="item-info">
              <span class="item-label">开机自启</span>
            </div>
            <div class="switch" id="sw-General-RunAtStartup"></div>
          </div>
          <div class="settings-item" onclick="toggleSwitch('General', 'AutoShowOverlay')">
            <div class="item-info">
              <span class="item-label">自动显示悬浮窗</span>
              <span class="item-desc">检测到 PPT 放映时自动显示工具栏</span>
            </div>
            <div class="switch" id="sw-General-AutoShowOverlay"></div>
          </div>
        </div>
      </div>

      <div class="section" id="section-interaction">
        <div class="group-title">交互</div>
        <div class="settings-group">
          <div class="settings-item" onclick="toggleSwitch('PPT', 'AutoHandleInk')">
            <div class="item-info">
              <span class="item-label">自动处理墨迹</span>
              <span class="item-desc">退出放映时自动处理"是否保留墨迹"</span>
            </div>
            <div class="switch" id="sw-PPT-AutoHandleInk"></div>
          </div>
          <div class="settings-item" onclick="toggleSwitch('Overlay', 'ShowStatusBar')">
            <div class="item-info">
              <span class="item-label">顶部状态栏</span>
              <span class="item-desc">在悬浮窗顶部显示时间与状态</span>
            </div>
            <div class="switch" id="sw-Overlay-ShowStatusBar"></div>
          </div>
          <div class="settings-item" onclick="toggleSwitch('Toolbar', 'ShowUndoRedo')">
            <div class="item-info">
              <span class="item-label">显示撤销/重做</span>
            </div>
            <div class="switch" id="sw-Toolbar-ShowUndoRedo"></div>
          </div>
        </div>
      </div>

      <div class="section" id="section-about">
        <div class="about-header">
          <div class="hyperos-bg"></div>
          <div class="about-logo-container">
            <svg viewBox="0 0 808 808" fill="none" xmlns="http://www.w3.org/2000/svg" class="about-main-logo">
              <path fill-rule="evenodd" d="M362.514 -1.98828C390.973 -2.04849 394.821 -1.9116 395.742 -0.801758C396.315 -0.110924 398.409 1.56091 400.395 2.91406C413.635 11.9337 423.888 26.9218 426.969 41.7588C427.42 43.9343 427.512 43.9688 431.167 43.3438C436.866 42.3701 449.885 42.8187 458.242 44.2764C471.665 46.619 479.911 49.242 492.178 55.0713C496.661 57.2021 500.617 58.9457 500.969 58.9463C501.32 58.9463 502.641 59.4501 503.906 60.0664C505.171 60.6828 509.626 61.7585 513.806 62.458C521.833 63.8016 527.955 63.4162 537.289 60.9785C548.36 58.0875 554.401 50.9036 555.487 39.3379C556.13 32.5001 557.277 32.8689 560.025 40.7969C565.314 56.0575 562.27 70.7209 551.62 81.2861C548.853 84.032 545.082 86.9908 543.242 87.8623C541.402 88.7335 539.893 89.6462 539.887 89.8906C539.882 90.1346 544.082 94.5913 549.22 99.7939C554.357 104.997 561.218 112.462 564.467 116.384C567.717 120.305 570.566 123.692 570.8 123.91C571.957 124.992 583.693 141.723 587.193 147.281C600.938 169.107 612.757 194.933 623.607 226.853C633.329 255.451 644.855 267.118 656.105 259.747C659.215 257.709 660.544 258.767 659.881 262.752C658.156 273.11 648.928 285.968 639.396 291.295C631.556 295.678 619.282 297.073 610.651 294.564C608.264 293.871 606.092 293.522 605.823 293.791C604.591 295.024 621.992 310.317 628.763 313.952C635.876 317.77 645.311 320.386 651.971 320.386C656.57 320.386 666.546 318.253 668.773 316.794C670.52 315.65 672.979 315.222 672.979 316.062C672.978 317.114 666.142 325.596 662.053 329.621C653.555 337.984 641.879 344.548 627.819 348.865C623.245 350.271 618.61 351.792 617.521 352.247C616.431 352.703 611.261 353.231 606.032 353.421C598.173 353.707 595.566 353.492 590.99 352.184C587.948 351.313 585.334 350.726 585.179 350.878C585.026 351.031 584.373 355.195 583.729 360.132C582.406 370.267 580.466 380.292 577.466 392.479C576.34 397.054 575.112 402.238 574.737 403.999C574.135 406.825 568.389 424.045 564.882 433.532C562.393 440.265 552.645 461.02 548.63 468.139C538.556 485.997 517.596 507.173 502.029 515.219C491.103 520.867 486.157 522.348 476.193 522.96C466.941 523.529 466.17 522.442 473.686 519.421C488.841 513.329 500.781 499.823 513.717 474.139C519.545 462.567 524.134 450.315 531.1 427.734C532.748 422.388 534.525 413.799 534.075 413.349C533.811 413.083 531.71 413.756 529.408 414.843C527.106 415.929 524.489 417.048 523.593 417.329C522.522 417.665 520.351 420.977 517.255 426.998C511.669 437.862 511.907 437.44 507.423 444.414C497.789 459.396 487.585 470.188 472.068 481.805C467.558 485.181 463.648 488.479 463.379 489.133C462.473 491.339 461.387 503.712 460.946 516.861C460.443 531.893 460.451 531.914 466.767 534.214C475.16 537.271 479.725 537.047 495.805 532.789C501.772 531.209 502.164 531.196 504.916 532.493C508.548 534.206 514.292 540.145 518.667 546.712C521.443 550.879 523.48 552.749 529.976 557.096C542.126 565.227 549.586 570.837 560.044 579.705C567.958 586.417 571.509 588.548 577.288 590.053C582.973 591.533 594.284 595.976 603.935 600.52C608.009 602.438 611.485 604.008 611.659 604.008C612.258 604.007 611.972 601.605 611.21 600.233C609.08 596.401 603.26 581.492 603.26 579.866C603.26 579.328 604.134 577.944 605.202 576.791C606.91 574.948 607.749 574.697 612.135 574.707C618.479 574.722 623.308 576.429 631.397 581.515C639.003 586.297 645.685 587.639 650.943 585.442C655.087 583.711 655.755 581.427 654.264 574.102C653.575 570.724 652.565 566.891 652.019 565.584C649.494 559.547 648.589 555.048 649.522 553.17C650.534 551.135 658.251 546.174 660.404 546.174C662.725 546.174 666.521 550.052 669.951 555.924C675.07 564.69 678.493 571.762 678.509 573.609C678.518 574.629 679.893 576.419 681.986 578.134C684.59 580.267 686.38 582.893 689.208 588.726C693.303 597.175 693.594 597.841 695.612 603.437C696.705 606.462 696.797 607.625 696.07 609.218C694.674 612.282 694.941 613.401 697.884 616.839C700.869 620.326 701.108 620.785 707.534 635.421C709.841 640.674 708.406 646.084 703.206 651.74C700.723 654.441 698.624 654.492 695.162 651.938C692.18 649.739 690.408 649.402 690.408 651.035C690.408 652.032 693.396 658.839 699.269 671.224L701.651 676.25L704.547 675.709C706.139 675.411 707.846 674.834 708.341 674.426C708.835 674.017 711.602 673.462 714.489 673.192C721.143 672.57 721.918 673.207 726.555 683.106C728.461 687.176 730.02 690.627 730.021 690.776C730.021 690.923 731.052 693.297 732.312 696.051C733.571 698.805 735.494 703.019 736.585 705.415C737.676 707.812 739.717 712.267 741.121 715.317C746.646 727.322 748.242 730.889 748.243 731.227C748.243 731.418 748.914 733.087 749.734 734.935C750.554 736.781 751.667 739.451 752.207 740.867C753.166 743.382 753.302 743.443 758.044 743.46C764.89 743.485 766.059 744.615 773.19 758.099C775.265 762.02 778.115 767.368 779.523 769.982C783.127 776.67 788.059 785.898 791.893 793.127C793.692 796.519 795.429 799.652 795.753 800.088C796.799 801.494 797.289 804.622 796.825 806.939L796.373 809.198H36L36.0127 807.02C36.0236 805.198 44.819 791.794 51.248 783.8C53.1368 781.451 55.8878 777.457 65.291 763.412C75.7376 747.808 79.7985 743.155 85.3721 740.406C89.3563 738.441 93.7069 733.514 102.236 721.308C107.211 714.187 116.391 699.647 121.272 691.154C122.901 688.322 126.893 682.263 130.146 677.691L136.061 669.379L134.754 665.702C132.74 660.03 133.013 659.106 138.202 654.044C140.816 651.494 142.955 649.145 142.955 648.823C142.955 648.502 141.398 646.22 139.495 643.752C133.111 635.471 131.04 630.149 129.427 617.872C127.786 605.392 130.002 590.315 135.48 576.676C140.909 563.163 151.985 543.669 160.513 532.619C162.927 529.491 162.762 528.745 159.655 528.745C157.848 528.745 149.363 526.05 144.936 524.07C144.064 523.68 141.925 522.745 140.183 521.993C134.548 519.562 123.729 511.845 118.595 506.597C111.468 499.31 102.88 486.165 104.31 484.732C104.523 484.519 106.16 485.762 107.945 487.494C114.691 494.041 121.847 495.887 140.183 495.812C151.504 495.765 154.724 495.472 160.385 493.975C168.006 491.958 179.56 487.23 185.665 483.63C187.922 482.299 190.054 481.211 190.403 481.211C190.753 481.211 191.628 480.558 192.349 479.762C193.593 478.387 193.453 478.215 189.611 476.416C184.55 474.046 179.975 468.927 177.716 463.105C174.8 455.593 175.546 442.695 179.394 434.072C179.783 433.201 181.017 430.418 182.136 427.89C183.255 425.36 184.519 422.864 184.942 422.344C185.367 421.822 186.642 420.238 187.776 418.821C188.911 417.405 190.155 416.247 190.54 416.247C190.931 416.247 191.022 419.574 190.745 423.791C190.052 434.34 192.576 441.399 198.568 445.672C203.833 449.427 215.291 447.097 222.443 440.818C225.648 438.004 225.678 437.532 223.003 431.695C219.397 423.827 218.22 420.944 218.22 419.979C218.22 419.407 217.929 418.602 217.574 418.188C217.219 417.773 215.95 414.225 214.753 410.305C212.537 403.044 212.241 402.02 209.938 393.668C209.217 391.054 208.328 387.846 207.964 386.538C206.703 382.017 204.815 373.047 203.961 367.523C203.49 364.474 202.966 361.088 202.798 359.998C202.63 358.909 202.466 357.955 202.434 357.877C202.401 357.8 200.325 358.973 197.819 360.483C195.313 361.994 192.373 363.443 191.283 363.704C190.194 363.965 188.947 364.425 188.511 364.729C184.916 367.235 168.453 367.983 160.824 365.988C154.73 364.395 153.866 363.511 156.424 361.487C159.807 358.81 165.251 353.337 166.097 351.761C166.849 350.359 166.67 350.294 163.446 350.8C155.292 352.078 149.804 352.237 145.135 351.327C139.484 350.227 127.868 346.165 124.337 344.056C123.03 343.275 120.8 342.044 119.383 341.322C116.389 339.796 105.719 330.127 105.719 328.939C105.719 328.47 106.959 328.292 108.69 328.512C115.638 329.394 125.928 326.095 135.711 319.849C147.953 312.032 164.246 291.871 168.65 279.089C169.828 275.67 169.998 275.916 164.494 273.101C158.95 270.263 148.916 262.701 144.33 257.902C137.494 250.75 131.233 241.096 127.053 231.259C123.053 221.848 119.143 206.08 120.479 204.748C120.883 204.346 121.504 204.987 126.317 210.771C130.607 215.926 143.02 223.445 150.585 225.469C152.272 225.92 156.753 226.666 160.546 227.127C168.068 228.04 173.944 227.182 179.474 224.361C185.251 221.414 185.876 219.962 188.083 204.322C188.452 201.708 189.129 197.965 189.589 196.004C195.038 172.732 194.54 174.442 200.076 159.957C201.774 155.515 205.128 148.746 207.607 144.757C211.318 138.786 211.983 137.137 210.945 136.479C210.372 136.115 209.298 135.813 208.562 135.806C207.825 135.799 207.002 135.437 206.732 135.001C206.463 134.565 205.601 134.209 204.816 134.209C203.119 134.209 194.108 129.721 191.294 127.475C183.687 121.4 176.422 111.229 174.715 104.261C173.562 99.5535 174.111 93.6509 175.835 92.2197C176.734 91.4743 177.164 91.8177 178.083 94.0176C180.926 100.821 194.291 105.655 210.298 105.669C225.538 105.682 238.466 101.587 245.949 94.374C247.91 92.4837 251.534 89.4243 254 87.5752C256.597 85.6288 259.064 82.9805 259.861 81.2852C263.577 73.3786 274.634 61.2287 282.945 55.9199C284.773 54.7522 286.587 52.9047 286.976 51.8154C287.365 50.7259 288.433 47.5116 289.349 44.6709C290.849 40.0197 292.005 37.69 296.945 29.3564C299.436 25.1553 304.54 19.2193 310.846 13.1904C316.314 7.96243 319.331 5.57386 327.553 -0.03125L330.325 -1.9209L362.514 -1.98828ZM215.92 562.069C215.658 562.098 213.307 563.325 210.693 564.796C208.079 566.268 205.406 567.735 204.752 568.058C197.551 571.602 186.047 580.554 176.99 589.663C163.981 602.744 155.29 616.31 151.561 629.35C149.799 635.51 149.829 634.905 151.272 634.905C152.42 634.905 158.712 630.731 162.762 627.282C173.337 618.275 178.898 612.899 185.442 605.347C198.995 589.709 200.64 588.472 211.299 585.903C213.375 585.403 215.792 584.994 216.672 584.994C218.61 584.994 219.529 583.006 218.284 581.507C217.787 580.907 217.157 576.276 216.886 571.217C216.615 566.158 216.18 562.042 215.92 562.069ZM316.461 475.477C316.461 473.505 313.85 475.542 310.891 479.824C309.007 482.548 304.812 488.073 301.567 492.103L295.669 499.43L298.954 503.78C308.337 516.206 316.643 522.539 325.021 523.65C329.831 524.288 329.994 525.362 325.527 526.967C321.263 528.498 309.727 527.782 302.992 525.567C296.637 523.478 288.063 519.402 286.007 517.494C285.162 516.711 284.203 516.069 283.875 516.069C283.547 516.069 281.586 518.298 279.519 521.021C277.451 523.744 274.097 527.933 272.065 530.329C265.643 537.908 251.73 556.984 248.787 562.246C245.651 567.854 243.952 572.169 244.616 572.834C245.475 573.692 250.728 571.358 257.475 567.123C261.252 564.751 264.437 562.812 264.554 562.812C264.68 562.805 269.323 560.151 274.881 556.907C288.653 548.87 292.119 548.088 308.142 549.401C327.767 551.01 330.666 549.712 332.272 538.597C333.195 532.213 333.268 498.673 332.373 492.37C331.708 487.689 331.577 487.537 321.675 480.031C318.808 477.859 316.462 475.81 316.461 475.477ZM375.662 14.9072C367.903 9.14627 359.016 6.82161 350.054 8.20801C346.288 8.79032 341.993 9.92306 338.248 11.3213C332.625 13.4207 319.915 20.4215 314.887 24.1895C305.94 30.8924 296.106 41.7974 294.035 47.3115C293.585 48.5118 293.79 48.6626 295.272 48.2197C296.25 47.9282 297.763 47.2541 298.635 46.7217C300.96 45.3004 314.701 40.1366 318.838 39.1289C325.182 37.5841 333.302 36.1958 342.073 35.1572C357.037 33.385 376.544 36.0865 388.054 41.5244C390.811 42.8268 393.301 43.8935 393.585 43.8936C395.476 43.8936 392.053 34.9221 387.365 27.5947C383.579 21.6751 380.975 18.8526 375.662 14.9072Z" />
            </svg>
          </div>
        </div>
        <div class="settings-group">
          <div class="settings-item" id="version-item">
            <div class="item-info">
              <span class="item-label">软件版本</span>
              <span class="item-desc" id="app-version"></span>
            </div>
            <div class="item-state">
              <svg class="chevron" viewBox="0 0 24 24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
              </svg>
            </div>
          </div>
          <div class="version-expander" id="version-expander">
            <div class="version-expander-inner">
              <div class="version-expander-text">
                copyright 2025-2026 Seirai Haraguchi / YunoFactory 丨本程序根据 GNU General Public License 3 获得许可
              </div>
              <div class="version-expander-links">
                <a href="#" target="_blank" rel="noopener noreferrer">GitHub 仓库地址</a>
                <a href="#" target="_blank" rel="noopener noreferrer">QQ群</a>
              </div>
            </div>
          </div>
          <div class="settings-item">
            <div class="item-info">
              <span class="item-label">检查更新</span>
            </div>
            <div class="item-state">
              <svg class="chevron" viewBox="0 0 24 24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="section" id="section-debug" style="display:none;">
        <div class="group-title">调试选项</div>
        <div class="settings-group">
          <div class="settings-item" onclick="createTestDialog()">
            <div class="item-info">
              <span class="item-label">创建 Dialog</span>
              <span class="item-desc">测试全新的 Dialog 设计风格</span>
            </div>
            <div class="item-state">
              <svg class="chevron" viewBox="0 0 24 24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
              </svg>
            </div>
          </div>
          <div class="settings-item" onclick="triggerTestCrash()">
            <div class="item-info">
              <span class="item-label" style="color: #ff4d4f;">触发测试崩溃</span>
              <span class="item-desc">手动触发一个 RuntimeError 以测试崩溃处理器的表现</span>
            </div>
            <div class="item-state">
              <svg class="chevron" viewBox="0 0 24 24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
              </svg>
            </div>
          </div>
        </div>
      </div> <!-- end of content -->
    </div> <!-- end of layout -->
  </body>  <script>
    function initNav() {
      const items = document.querySelectorAll(".sidebar-item");
      const sections = document.querySelectorAll(".section");
      const title = document.getElementById("section-title");
      const titleMap = {
        general: "通用",
        interaction: "交互",
        about: "关于",
        debug: "调试"
      };
      items.forEach(function (item) {
        item.addEventListener("click", function () {
          const key = item.getAttribute("data-section");
          items.forEach(function (i) {
            i.classList.remove("active");
          });
          item.classList.add("active");
          sections.forEach(function (sec) {
            sec.classList.toggle("active", sec.id === "section-" + key);
          });
          if (title && titleMap[key]) {
            title.textContent = titleMap[key];
            title.style.display = key === 'about' ? 'none' : 'block';
          }
        });
      });
    }

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (settings.Appearance?.ThemeMode === 'Auto') {
        applySettingsToUI();
      }
    });

    initNav();

    let settings = window.initialSettings || {
      General: { RunAtStartup: false, AutoShowOverlay: true },
      PPT: { AutoHandleInk: true },
      Overlay: { ShowStatusBar: true },
      Toolbar: { ShowUndoRedo: false },
      Appearance: { ThemeMode: 'Light' }
    };

    // Apply immediately if injected
    if (window.initialSettings) {
      applySettingsToUI();
    }

    window.addEventListener('pywebviewready', () => {
      if (!window.pywebview || !window.pywebview.api || !window.pywebview.api.get_settings) return;
      
      // Still fetch to be sure, but we already have initialSettings
      window.pywebview.api.get_settings().then(function (res) {
        if (res && Object.keys(res).length > 0) {
          settings = res;
          applySettingsToUI();
        }
      }).catch(err => console.error("Failed to get settings:", err));
    });

    function applySettingsToUI() {
      setSwitch('General', 'RunAtStartup');
      setSwitch('General', 'AutoShowOverlay');
      setSwitch('PPT', 'AutoHandleInk');
      setSwitch('Overlay', 'ShowStatusBar');
      setSwitch('Toolbar', 'ShowUndoRedo');

      const mode = settings.Appearance?.ThemeMode || 'Light';
      document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
      const activeOpt = document.getElementById(`theme-${mode}`);
      if (activeOpt) activeOpt.classList.add('active');

      if (mode === 'Auto') {
        const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
      } else {
        document.documentElement.setAttribute('data-theme', mode.toLowerCase());
      }

      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const accent = isDark ? '#E1EBFF' : '#3275F5';
      document.documentElement.style.setProperty('--accent-blue', accent);

      if (window.pywebview && window.pywebview.api && window.pywebview.api.get_version) {
        window.pywebview.api.get_version().then(v => {
          if (!v) return;
          const codeName = v.code_name || "";
          const codeNameCN = v.code_name_CN || "";
          const version = v.version || "";
          const build = v.build != null ? v.build : "";
          const el = document.getElementById("app-version");
          if (el) {
            el.textContent = `Version ${version} (${codeName}) Build ${build}`;
          }
        }).catch(err => console.error("Failed to get version:", err));
      }
    }

    function setTheme(mode) {
      if (!settings.Appearance) settings.Appearance = {};
      settings.Appearance.ThemeMode = mode;
      applySettingsToUI();
      if (window.pywebview && window.pywebview.api.save_setting) {
        window.pywebview.api.save_setting('Appearance', 'ThemeMode', mode);
      }
    }

    function setSwitch(cat, key) {
      const val = settings[cat]?.[key] ?? false;
      const el = document.getElementById(`sw-${cat}-${key}`);
      if (el) {
        if (val) el.classList.add('active');
        else el.classList.remove('active');
      }
    }

    function toggleSwitch(cat, key) {
      const el = document.getElementById(`sw-${cat}-${key}`);
      if (!el) return;

      const isActive = el.classList.contains('active');
      const newState = !isActive;

      if (newState) el.classList.add('active');
      else el.classList.remove('active');

      if (!settings[cat]) settings[cat] = {};
      settings[cat][key] = newState;

      if (window.pywebview && window.pywebview.api.save_setting) {
        window.pywebview.api.save_setting(cat, key, newState);
      }
    }

    function triggerTestCrash() {
      if (window.pywebview && window.pywebview.api.trigger_crash) {
        window.pywebview.api.trigger_crash();
      }
    }

    function createTestDialog() {
      if (window.pywebview && window.pywebview.api.create_dialog) {
        window.pywebview.api.create_dialog();
      }
    }

    (function () {
      const versionItem = document.getElementById('version-item');
      const debugSection = document.getElementById('section-debug');
      const debugNav = document.getElementById('nav-debug');
      const expander = document.getElementById('version-expander');
      if (!versionItem || !debugSection) return;
      let tapCount = 0;
      versionItem.addEventListener('click', () => {
        if (expander) {
          const isHidden = window.getComputedStyle(expander).display === 'none';
          expander.style.display = isHidden ? 'block' : 'none';
        }
        tapCount += 1;
        if (tapCount >= 5) {
          debugSection.style.display = '';
          if (debugNav) debugNav.style.display = 'flex';
        }
      });
    })();

    // JS Bridge for real-time updates
    function updateTheme(mode) {
      if (!settings.Appearance) settings.Appearance = {};
      settings.Appearance.ThemeMode = mode;
      applySettingsToUI();
    }

    function updateAccentColor() {}
  </script>
</body>

</html>
