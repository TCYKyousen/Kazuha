from PyQt6.QtCore import QObject, pyqtSignal

class I18nManager(QObject):
    language_changed = pyqtSignal(str)
    
    _instance = None
    
    @classmethod
    def instance(cls):
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance
    
    def __init__(self):
        super().__init__()
        self.current_language = "Simplified Chinese"
        self.translations = {
            "Simplified Chinese": {
                "Settings": "设置",
                "General": "常规",
                "Personalization": "个性化",
                "Clock": "时钟组件",
                "Update": "更新",
                "About": "关于",
                "Debug": "调试",
                "Basic Settings": "基础设置",
                "Enable StartUp": "开机自启",
                "Enable StartUp Desc": "在 Windows 系统启动时自动运行 Kazuha，让演示助手随时待命。",
                "System Notification": "系统通知",
                "System Notification Desc": "启用后，Kazuha 将通过 Windows 通知中心发送重要提醒，如更新提示或状态变更。",
                "Global Sound": "全局音效",
                "Global Sound Desc": "为关键操作（如切换工具、倒计时结束等）提供清脆的音效反馈，增强交互感知。",
                "Global Animation": "全局过渡动画",
                "Global Animation Desc": "启用平滑的界面切换和缩放效果，让操作体验更加自然、连贯。",
                "Theme and Color": "主题与颜色",
                "App Theme": "应用主题",
                "App Theme Desc": "根据个人喜好选择浅色或深色模式，或者跟随 Windows 系统主题自动切换。",
                "Color Mode": "取色方式",
                "Color Mode Desc": "决定 Kazuha 如何确定主色调：可以自动捕捉屏幕内容、壁纸，或手动指定。",
                "Custom Color": "自定义颜色",
                "Custom Color Desc": "当取色方式设为“自定义”时，您可以在此处精确指定 Kazuha 的主题色。",
                "Update Interval": "取色间隔",
                "Update Interval Desc": "设置动态取色（如屏幕或壁纸取色）的频率，较长的时间间隔可节省资源。",
                "Layout and Position": "布局与位置",
                "Nav Position": "翻页导航位置",
                "Nav Position Desc": "调整幻灯片翻页按钮在屏幕上的分布方式，以适应不同的演示习惯或屏幕比例。",
                "Component Scale": "组件整体缩放",
                "Component Scale Desc": "通过滑块统一调整所有悬浮组件（工具栏、翻页键等）的大小，匹配高分屏或演示环境。",
                "Screen Padding": "组件屏幕边距",
                "Screen Padding Desc": "设置悬浮组件距离屏幕边缘的安全距离，防止内容被遮挡或溢出。",
                "Timer Position": "计时器位置",
                "Timer Position Desc": "选择倒计时窗口弹出时的默认位置，确保不干扰您的主要演示内容。",
                "Display and Style": "显示与样式",
                "Show Clock": "显示时钟",
                "Show Clock Desc": "在桌面上显示一个半透明、可穿透的悬浮时钟，方便在全屏演示时掌控时间。",
                "Clock Position": "时钟位置",
                "Clock Position Desc": "将悬浮时钟固定在屏幕的四个角落之一，保持界面整洁且不影响视线。",
                "Clock Style": "时钟样式",
                "Clock Style Desc": "深度自定义时钟的显示内容（秒、日期、农历）以及字体的粗细样式。",
                "Update Title": "版本更新",
                "Check Update": "检查更新",
                "Check Update Desc": "连接到服务器以获取 Kazuha 的最新版本，享受新功能与修复。",
                "Current Version": "当前版本",
                "Code Name": "内部代号",
                "Build Date": "构建时间",
                "Light": "浅色",
                "Dark": "深色",
                "Auto": "跟随系统",
                "Screen Color": "屏幕取色",
                "Wallpaper Color": "壁纸取色",
                "System Accent": "系统主题",
                "Custom": "自定义",
                "Bottom Sides": "底部两端",
                "Middle Sides": "中部两侧",
                "Top Left": "左上角",
                "Top Right": "右上角",
                "Bottom Left": "左下角",
                "Bottom Right": "右下角",
                "Center": "屏幕中央",
                "Check Now": "立即检查",
                "Latest Version": "已是最新版本",
                "New Version": "发现新版本",
                "Check Failed": "检查失败",
                "Language": "语言",
                "Language Desc": "更改 Kazuha 的界面语言。切换后需要重新启动应用程序才能生效。",
                "Exit": "退出",
                "App Description": "为课堂与演示打造的轻量级演示助手",
                "Unknown": "未知",
                "Version Code": "版本号",
                "GitHub Repo": "GitHub 仓库",
                "Restart Now": "立即重启",
                "Restart Required": "需要重启",
                "Restart Desc": "某些设置需要重启应用程序才能生效。"
            },
            "Traditional Chinese": {
                "Settings": "設定",
                "General": "常規",
                "Personalization": "個性化",
                "Clock": "時鐘組件",
                "Update": "更新",
                "About": "關於",
                "Debug": "調試",
                "Basic Settings": "基礎設置",
                "Enable StartUp": "開機自啟",
                "Enable StartUp Desc": "在 Windows 系統啟動時自動運行 Kazuha，讓演示助手隨時待命。",
                "System Notification": "系統通知",
                "System Notification Desc": "啟用後，Kazuha 將通過 Windows 通知中心發送重要提醒，如更新提示或狀態變更。",
                "Global Sound": "全局音效",
                "Global Sound Desc": "為關鍵操作（如切換工具、倒計時結束等）提供清脆的音效反饋，增強交互感知。",
                "Global Animation": "全局過渡動畫",
                "Global Animation Desc": "啟用平滑的界面切換和縮放效果，讓操作體驗更加自然、連貫。",
                "Theme and Color": "主題與顏色",
                "App Theme": "應用主題",
                "App Theme Desc": "根據個人喜好選擇淺色或深色模式，或者跟隨 Windows 系統主題自動切換。",
                "Color Mode": "取色方式",
                "Color Mode Desc": "決定 Kazuha 如何確定主色調：可以自動捕捉屏幕內容、壁紙，或手動指定。",
                "Custom Color": "自定義顏色",
                "Custom Color Desc": "當取色方式設為“自定義”時，您可以在此處精確指定 Kazuha 的主題色。",
                "Update Interval": "取色間隔",
                "Update Interval Desc": "設置動態取色（如屏幕或壁紙取色）的頻率，較長的時間間隔可節省資源。",
                "Layout and Position": "佈局與位置",
                "Nav Position": "翻頁導航位置",
                "Nav Position Desc": "調整幻燈片翻頁按鈕在屏幕上的分佈方式，以適應不同的演示習慣或屏幕比例。",
                "Component Scale": "組件整體縮放",
                "Component Scale Desc": "通過滑塊統一調整所有懸浮組件（工具欄、翻頁鍵等）的大小，匹配高分屏或演示環境。",
                "Screen Padding": "組件屏幕邊距",
                "Screen Padding Desc": "設置懸浮組件距離屏幕邊緣的安全距離，防止內容被遮擋或溢出。",
                "Timer Position": "計時器位置",
                "Timer Position Desc": "選擇倒計時窗口彈出時的默認位置，確保不干擾您的主要演示內容。",
                "Display and Style": "顯示與樣式",
                "Show Clock": "顯示時鐘",
                "Show Clock Desc": "在桌面上顯示一個半透明、可穿透的懸浮時鐘，方便在全屏演示時掌控時間。",
                "Clock Position": "時鐘位置",
                "Clock Position Desc": "將懸浮時鐘固定在屏幕的四個角落之一，保持界面整潔且不影響視線。",
                "Clock Style": "時鐘樣式",
                "Clock Style Desc": "深度自定義時鐘的顯示內容（秒、日期、農曆）以及字體的粗細樣式。",
                "Update Title": "版本更新",
                "Check Update": "檢查更新",
                "Check Update Desc": "連接到服務器以獲取 Kazuha 的最新版本，享受新功能與修復。",
                "Current Version": "當前版本",
                "Code Name": "內部代號",
                "Build Date": "構建時間",
                "Light": "淺色",
                "Dark": "深色",
                "Auto": "跟隨系統",
                "Screen Color": "屏幕取色",
                "Wallpaper Color": "壁紙取色",
                "System Accent": "系統主題",
                "Custom": "自定義",
                "Bottom Sides": "底部兩端",
                "Middle Sides": "中部兩側",
                "Top Left": "左上角",
                "Top Right": "右上角",
                "Bottom Left": "左下角",
                "Bottom Right": "右下角",
                "Center": "屏幕中央",
                "Check Now": "立即檢查",
                "Latest Version": "已是最新版本",
                "New Version": "發現新版本",
                "Check Failed": "檢查失敗",
                "Language": "語言",
                "Language Desc": "更改 Kazuha 的界面語言。切換後需要重新啟動應用程序才能生效。",
                "Exit": "退出",
                "App Description": "為課堂與演示打造的輕量級演示助手",
                "Unknown": "未知",
                "Version Code": "版本號",
                "GitHub Repo": "GitHub 倉庫",
                "Restart Now": "立即重啟",
                "Restart Required": "需要重啟",
                "Restart Desc": "某些設置需要重啟應用程序才能生效。"
            },
            "English": {
                "Settings": "Settings",
                "General": "General",
                "Personalization": "Personalization",
                "Clock": "Clock",
                "Update": "Update",
                "About": "About",
                "Debug": "Debug",
                "Basic Settings": "Basic Settings",
                "Enable StartUp": "Enable Start-up",
                "Enable StartUp Desc": "Run Kazuha automatically when Windows starts, so the assistant is always ready.",
                "System Notification": "System Notifications",
                "System Notification Desc": "Kazuha will send important reminders, such as update alerts or status changes, through the Windows Action Center.",
                "Global Sound": "Global Sound Effects",
                "Global Sound Desc": "Provides crisp audio feedback for key actions like switching tools or timer completion to enhance interaction awareness.",
                "Global Animation": "Global Transitions",
                "Global Animation Desc": "Enable smooth interface transitions and scaling effects for a more natural and fluid user experience.",
                "Theme and Color": "Theme & Color",
                "App Theme": "Application Theme",
                "App Theme Desc": "Choose between Light or Dark mode, or have it automatically follow the Windows system theme.",
                "Color Mode": "Color Sampling",
                "Color Mode Desc": "Determines how Kazuha sets the accent color: automatically capture from screen content, wallpaper, or set it manually.",
                "Custom Color": "Custom Color",
                "Custom Color Desc": "When the sampling mode is set to 'Custom', you can precisely specify Kazuha's theme color here.",
                "Update Interval": "Sampling Interval",
                "Update Interval Desc": "Set the frequency for dynamic color sampling (like screen or wallpaper). Longer intervals save system resources.",
                "Layout and Position": "Layout & Position",
                "Nav Position": "Navigation Position",
                "Nav Position Desc": "Adjust the distribution of slide navigation buttons to suit different presentation habits or screen aspect ratios.",
                "Component Scale": "Global Component Scaling",
                "Component Scale Desc": "Unified scaling of all floating components (toolbar, nav keys, etc.) to match high-resolution screens or environments.",
                "Screen Padding": "Screen Padding",
                "Screen Padding Desc": "Set a safe margin between floating components and the screen edges to prevent overlapping or clipping.",
                "Timer Position": "Timer Position",
                "Timer Position Desc": "Choose the default pop-up location for the countdown window to ensure it doesn't interfere with your main content.",
                "Display and Style": "Display & Style",
                "Show Clock": "Show Floating Clock",
                "Show Clock Desc": "Display a translucent, click-through clock on the desktop to keep track of time during full-screen presentations.",
                "Clock Position": "Clock Position",
                "Clock Position Desc": "Anchor the floating clock to one of the four corners of the screen to keep the interface clean and unobstructed.",
                "Clock Style": "Clock Style",
                "Clock Style Desc": "Deeply customize the clock's content (seconds, date, lunar) and the font weight/style.",
                "Update Title": "Version Update",
                "Check Update": "Check for Updates",
                "Check Update Desc": "Connect to the server to get the latest version of Kazuha and enjoy new features and bug fixes.",
                "Current Version": "Current Version",
                "Code Name": "Code Name",
                "Build Date": "Build Date",
                "Light": "Light",
                "Dark": "Dark",
                "Auto": "System",
                "Screen Color": "Screen",
                "Wallpaper Color": "Wallpaper",
                "System Accent": "System",
                "Custom": "Custom",
                "Bottom Sides": "Bottom Sides",
                "Middle Sides": "Middle Sides",
                "Top Left": "Top Left",
                "Top Right": "Top Right",
                "Bottom Left": "Bottom Left",
                "Bottom Right": "Bottom Right",
                "Center": "Center",
                "Check Now": "Check Now",
                "Latest Version": "Up to Date",
                "New Version": "Update Available",
                "Check Failed": "Check Failed",
                "Language": "Language",
                "Language Desc": "Change the interface language of Kazuha. Requires an application restart to take effect.",
                "Exit": "Exit",
                "App Description": "A lightweight presentation assistant for classrooms and demos.",
                "Unknown": "Unknown",
                "Version Code": "Version Code",
                "GitHub Repo": "GitHub Repository",
                "Restart Now": "Restart Now",
                "Restart Required": "Restart Required",
                "Restart Desc": "Some settings require a restart to take effect."
            },
            "Japanese": {
                "Settings": "設定",
                "General": "一般",
                "Personalization": "パーソナライズ",
                "Clock": "時計",
                "Update": "アップデート",
                "About": "バージョン情報",
                "Debug": "デバッグ",
                "Basic Settings": "基本設定",
                "Enable StartUp": "自動起動",
                "Enable StartUp Desc": "Windows の起動時に Kazuha を自動的に実行し、アシスタントがいつでも待機できるようにします。",
                "System Notification": "システム通知",
                "System Notification Desc": "有効にすると、Kazuha は Windows 通知センターを通じて更新通知や状態変更などの重要な通知を送信します。",
                "Global Sound": "グローバルサウンド",
                "Global Sound Desc": "ツールの切り替えやタイマー終了などの重要な操作に対して、クリアなサウンドフィードバックを提供します。",
                "Global Animation": "グローバルアニメーション",
                "Global Animation Desc": "滑らかなインターフェースの切り替えとスケーリング効果を有効にし、操作をより自然でスムーズにします。",
                "Theme and Color": "テーマと色",
                "App Theme": "アプリのテーマ",
                "App Theme Desc": "ライトモード、ダークモード、または Windows システムテーマに合わせた自動切り替えを選択できます。",
                "Color Mode": "配色モード",
                "Color Mode Desc": "Kazuha のアクセントカラーの決定方法を選択します。画面、壁紙からの自動取得、または手動設定が可能です。",
                "Custom Color": "カスタムカラー",
                "Custom Color Desc": "配色モードが「カスタム」に設定されている場合、ここで Kazuha のテーマカラーを正確に指定できます。",
                "Update Interval": "更新間隔",
                "Update Interval Desc": "動的な配色取得（画面や壁紙など）の頻度を設定します。間隔を長くするとリソースを節約できます。",
                "Layout and Position": "レイアウトと位置",
                "Nav Position": "ナビゲーションの位置",
                "Nav Position Desc": "スライド切り替えボタンの配置を調整し、プレゼンテーションの習慣や画面比率に合わせます。",
                "Component Scale": "コンポーネントの縮放",
                "Component Scale Desc": "すべてのフローティングコンポーネント（ツールバー、ナビキーなど）のサイズを統一して調整します。",
                "Screen Padding": "画面の余白",
                "Screen Padding Desc": "フローティングコンポーネントと画面端の間の安全な余白を設定し、重なりや見切れを防ぎます。",
                "Timer Position": "タイマーの位置",
                "Timer Position Desc": "カウントダウンウィンドウが表示されるデフォルトの位置を選択し、メインコンテンツを妨げないようにします。",
                "Display and Style": "表示とスタイル",
                "Show Clock": "時計を表示",
                "Show Clock Desc": "デスクトップに半透明のフローティング時計を表示し、フルスクリーンでのプレゼン中も時間を把握できます。",
                "Clock Position": "時計の位置",
                "Clock Position Desc": "フローティング時計を画面の四隅のいずれかに固定し、視界を妨げないように配置します。",
                "Clock Style": "時計のスタイル",
                "Clock Style Desc": "時計の表示内容（秒、日付、旧暦）やフォントの太さを詳細にカスタマイズします。",
                "Update Title": "バージョン更新",
                "Check Update": "更新を確認",
                "Check Update Desc": "サーバーに接続して Kazuha の最新バージョンを取得し、新機能や修正を適用します。",
                "Current Version": "現在のバージョン",
                "Code Name": "コードネーム",
                "Build Date": "ビルド日時",
                "Light": "ライト",
                "Dark": "ダーク",
                "Auto": "システム",
                "Screen Color": "画面",
                "Wallpaper Color": "壁紙",
                "System Accent": "システム",
                "Custom": "カスタム",
                "Bottom Sides": "下部両端",
                "Middle Sides": "中央両側",
                "Top Left": "左上",
                "Top Right": "右上",
                "Bottom Left": "左下",
                "Bottom Right": "右下",
                "Center": "画面中央",
                "Check Now": "今すぐ確認",
                "Latest Version": "最新の状態です",
                "New Version": "新しいバージョンがあります",
                "Check Failed": "確認に失敗しました",
                "Language": "言語",
                "Language Desc": "Kazuha の表示言語を変更します。変更を適用するには、アプリケーションの再起動が必要です。",
                "Exit": "終了",
                "App Description": "教室やデモのために作られた軽量なプレゼンテーション助手",
                "Unknown": "不明",
                "Version Code": "バージョンコード",
                "GitHub Repo": "GitHub リポジトリ",
                "Restart Now": "今すぐ再起動",
                "Restart Required": "再起動が必要",
                "Restart Desc": "一部の設定を適用するには、アプリケーションの再起動が必要です。"
            }
        }
    
    def set_language(self, lang):
        if lang in self.translations:
            self.current_language = lang
            self.language_changed.emit(lang)
            
    def get_text(self, key, default=None):
        lang_dict = self.translations.get(self.current_language, {})
        return lang_dict.get(key, default if default is not None else key)

def tr(key, default=None):
    return I18nManager.instance().get_text(key, default)
